<html>
<head>
<script
  src="https://code.jquery.com/jquery-3.6.4.min.js"
  integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8="
  crossorigin="anonymous"></script>
<style>
label { cursor: hand; }
.tile,.picker label { background-image: url(tiles.png); min-width: 7px; min-height: 47px; }

input { position: absolute; left: -999px; }
input + label { display: none; }
:checked + label { display: inline-block; }

.shadow label {
    display: inline-flex;
    flex-direction: column;
    min-height: 47px;
    justify-content: space-between;
    align-items: center;
    vertical-align: bottom;
}

.picker {
    display: none;
    position: absolute;
    margin-top: 47px;
    white-space: nowrap;
    z-index: 998;
    border: 1px solid gray;
    border-radius: 7px;
    padding: 1px;
    background-color: silver;
    opacity: 0.8;
    transition: background-color 0.5s;
}

.picker input + .w  { min-height: 20px; }
.picker input + .a,
.picker input + .l { min-height: 16px; }
.picker input + label:hover { background-color: white; }
.picker input + label:hover {
    background-color: transparent;
    cursor: pointer;
}
.picker :checked + label {
    border: 1px solid red;
    background-color: white;
    border-radius: 2px;
}

.picker input + label { display: inline-block; margin: 1px; } 

:root {
    --wheel-offset: -29px;
    --window-offset: -47px;
    --door-offset: -78px;
    --front-offset: -103px;
    --extra-offset: -110px;
    --v-offset: -47px;
}

.shadow:has(~ .picker :checked + .h0) .top, .h0 { background-position: var(--front-offset) 0; width: 7px; }
.shadow:has(~ .picker :checked + .h1) .top, .h1 { background-position: var(--front-offset) var(--v-offset); width: 7px; }

.shadow:has(~ .picker :checked + .t0) .top, .t0 { background-position: 0 0; width: 7px; }
.shadow:has(~ .picker :checked + .t1) .top, .t1 { background-position: -8px 0; width: 20px; }

.shadow:has(~ .picker :checked + .d0) .top, .d0 { background-position: var(--door-offset) 0; width: 16px; }
.shadow:has(~ .picker :checked + .d1) .top, .d1 { background-position: var(--door-offset) var(--v-offset); width: 16px; }
.shadow:has(~ .picker :checked + .d2) .top, .d2 { background-position: var(--door-offset) calc(var(--v-offset) * 2); width: 16px; }
.shadow:has(~ .picker :checked + .d3) .top, .d3 { background-position: var(--door-offset) calc(var(--v-offset) * 3); width: 16px; }
.shadow:has(~ .picker :checked + .d4) .top, .d4 { background-position: var(--door-offset) calc(var(--v-offset) * 4); width: 22px; }
.shadow:has(~ .picker :checked + .d5) .top, .d5 { background-position: var(--door-offset) calc(var(--v-offset) * 5); width: 22px; }
.shadow:has(~ .picker :checked + .d6) .top, .d6 { background-position: var(--door-offset) calc(var(--v-offset) * 6); width: 24px; }
.shadow:has(~ .picker :checked + .d7) .top, .d7 { background-position: var(--door-offset) calc(var(--v-offset) * 7); width: 22px; }
.shadow:has(~ .picker :checked + .d8) .top, .d8 { background-position: var(--door-offset) calc(var(--v-offset) * 8); width: 16px; }

.shadow:has(~ .picker :checked + .w) .top,
.w { min-height: 21px; }
.shadow:has(~ .picker :checked + .w0) .top, .w0 { background-position: var(--window-offset) 0; width: 25px;  }
.shadow:has(~ .picker :checked + .w1) .top, .w1 { background-position: var(--window-offset) var(--v-offset); width: 25px; }
.shadow:has(~ .picker :checked + .w2) .top, .w2 { background-position: var(--window-offset) calc(var(--v-offset) * 2); width: 25px; }
.shadow:has(~ .picker :checked + .w3) .top, .w3 { background-position: var(--window-offset) calc(var(--v-offset) * 3); width: 14px; }
.shadow:has(~ .picker :checked + .w4) .top, .w4 { background-position: var(--window-offset) calc(var(--v-offset) * 4); width: 14px; }
.shadow:has(~ .picker :checked + .w5) .top, .w5 { background-position: var(--window-offset) calc(var(--v-offset) * 5); width: 14px; }
.shadow:has(~ .picker :checked + .w6) .top, .w6 { background-position: var(--window-offset) calc(var(--v-offset) * 6); width: 7px; }
.shadow:has(~ .picker :checked + .w7) .top, .w7 { background-position: var(--window-offset) calc(var(--v-offset) * 7); width: 30px; }
.shadow:has(~ .picker :checked + .w8) .top, .w8 { background-position: var(--window-offset) calc(var(--v-offset) * 8); width: 30px; }

.shadow:has(~ .picker :checked + .a) .bottom,
.a { min-height: 16px; }
.shadow:has(~ .picker :checked + .a0) .bottom, .a0 { background-position: var(--wheel-offset) -29px; width: 16px; }
.shadow:has(~ .picker :checked + .a1) .bottom, .a1 { background-position: var(--wheel-offset) calc(var(--v-offset) * 1 - 29px); width: 17px; }
.shadow:has(~ .picker :checked + .a2) .bottom, .a2 { background-position: var(--wheel-offset) calc(var(--v-offset) * 2 - 29px); width: 15px; }
.shadow:has(~ .picker :checked + .a3) .bottom, .a3 { background-position: var(--wheel-offset) calc(var(--v-offset) * 3 - 29px); width: 16px; }
.shadow:has(~ .picker :checked + .a4) .bottom, .a4 { background-position: var(--wheel-offset) calc(var(--v-offset) * 4 - 29px); width: 17px; }
.shadow:has(~ .picker :checked + .a5) .bottom, .a5 { background-position: var(--wheel-offset) calc(var(--v-offset) * 5 - 29px); width: 15px; }

.shadow:has(~ .picker input:checked + .l) .bottom,
.l { min-height: 16px; }
.shadow:has(~ .picker :checked + .l0) .bottom, .l0 { background-position: var(--window-offset) -29px; width: 18px;  }
.shadow:has(~ .picker :checked + .l1) .bottom, .l1 { background-position: var(--window-offset) calc(var(--v-offset) * 1 - 29px); width: 20px;  }
.shadow:has(~ .picker :checked + .l2) .bottom, .l2 { background-position: var(--window-offset) calc(var(--v-offset) * 2 - 29px); width: 20px;  }
.shadow:has(~ .picker :checked + .l3) .bottom, .l3 { background-position: var(--window-offset) calc(var(--v-offset) * 3 - 29px); width: 20px;  }
.shadow:has(~ .picker :checked + .l4) .bottom, .l4 { background-position: var(--window-offset) calc(var(--v-offset) * 4 - 29px); width: 13px;  }
.shadow:has(~ .picker :checked + .l5) .bottom, .l5 { background-position: var(--window-offset) calc(var(--v-offset) * 5 - 29px); width: 13px;  }

.spot0 { background-position: var(--extra-offset) 0; width: 16px; }
.spot1 { background-position: var(--extra-offset) var(--v-offset); width: 22px; }
.shadow:has(~ .picker :checked + .spot2) .top, .spot2 { background-position: var(--extra-offset) calc(var(--v-offset) * 2); width: 6px; }
.blank { background-position: var(--extra-offset) calc(var(--v-offset) * 3); width: 22px; }

.tile.bottom,
.picker input + .a,
.picker input + .l { display: none; }

.shadow,
.shadow:has(~ .picker :checked + .l) .bottom,
.shadow:has(~ .picker :checked + .a) .bottom,
.picker :checked + .w ~ :checked + .a,
.picker :checked + .w ~ .a,
.picker :checked + .w ~ :checked + .l,
.picker :checked + .w ~ .l { display: inline-block; }

.slot:has(.picker :checked + .h) ~ .slot,
.slot:has(.picker :checked + .spot) ~ .slot:has(.picker :checked + .spot) { display: none; }

.shadow:has(~ .picker :checked + .spot2) .top,
.spot2,
blink {
  animation: blink-animation 1s steps(5, start) infinite;
  -webkit-animation: blink-animation 1s steps(5, start) infinite;
}
@keyframes blink-animation { to { opacity: 0.2; } }
@-webkit-keyframes blink-animation { to { opacity: 0.2; } }

.slot,
.tile { display: inline-block; }
.shadow:has(.close) { background-color: #faa; }
.picker,
.open:checked + label,
.shadow:has(.close) label { display: none; }

.shadow:has(.open:checked) ~ .picker { display: inline-block; }
.shadow:has(.open:checked) ~ .shadow:has(.close) label { display: inline-flex; }
</style>
<script>
$(function() {
    function option$(typ, uid, groupName, cls, checked) {
        var val = typ + uid;
        var name = groupName + cls;
        var id = groupName + val;
        return [
            $('<input/>', {'type': 'radio', value: val, id: id, checked: checked, name: name}),
            $('<label/>', {'class': typ + ' ' + val, 'for': id, title: val }).html('&nbsp;')
        ];
    }
    
    function shadow$(parentId, action) {
        var id = parentId + '-' + action;
        return $('<div class="shadow" />').append(
                $('<input/>', {'type': "radio", name: 'modal', id: id, 'class': action}),
                $('<label/>', {'for': id}).append(
                    '<span class="tile top blank"/>',
                    '<span class="tile bottom blank"/>'
                ),
            );
    }
    
    function slot$(parentId, n) {
        var groupName = parentId + 'slot' + n;
        return $('<span class="slot" />').append(
            shadow$(groupName, 'open'),
            shadow$(groupName, 'close'),
            $('<div/>', {'class': 'picker'}).append(
                option$('spot', 2, groupName, 'top', 'checked'),
                $.map(Array.from(new Array(2).keys()), function(n) {
                    return option$('t', n, groupName, 'top');
                }),
                $.map(Array.from(new Array(2).keys()), function(n) {
                    return option$('h', n, groupName, 'top');
                }),
                '<br/>',
                $.map(Array.from(new Array(9).keys()), function(n) {
                    return option$('d', n, groupName, 'top');
                }),
                '<br/>',
                $.map(Array.from(new Array(9).keys()), function(n) {
                    return option$('w', n, groupName, 'top');
                }),
                '<br/>',
                $.map(Array.from(new Array(6).keys()), function(n) {
                    return option$('a', n, groupName, 'bottom');
                }),
                '<br/>',
                $.map(Array.from(new Array(6).keys()), function(n) {
                    return option$('l', n, groupName , 'bottom');
                })
            )
        );
    }
    
    function playground$(id) {
        return $('<div class="playground" id="' + id + '" />')
            .append($.map(Array.from(new Array(20).keys()), function(n) {
                return slot$(id, n);
            }));
    }
    
    $('#slots').replaceWith(
        $.map(Array.from(new Array(7).keys()), function(n) {
            return playground$('playground' + n);
        })
    );
    
    function inflateBus(board, blueprint) {
        var a = blueprint.split(' ');
        
        var cbnames = [];
        $(':input[name!=""]', board).each(function() {
            if (!~$.inArray(this.name, cbnames)) {
                cbnames.push(this.name);
                var prefix = a[0].substr(0, 1);
                
                var radio$ = $(':input[name="' + this.name + '"]', board);
                var prefixes = [];
                radio$.each(function() {
                    var p = $(this).val().substr(0, 1);
                    if(!~$.inArray(p, prefixes)) {
                        prefixes.push(p);
                    }
                });
                
                if(prefixes.includes(prefix)) {
                    radio$.val([a.shift()]);
                    if(0 == a.length) return false;
                }
            }
        });
    }
    
    inflateBus('#playground0', 't0 d7 w2 a0 w2 l0 d7 w2 l3 w2 a3 d4 h0');
    inflateBus('#playground1', 't0 w4 l4 d0 w7 a1 w7 l1 w7 l1 w7 a4 d0 h0');
    inflateBus('#playground2', 't0 w4 l4 w4 w8 a1 w8 l1 w8 l1 w8 a4 d0 h0');
    inflateBus('#playground3', 't0 w6 d0 w8 a2 w8 l1 w2 a5 d0 h0');
    inflateBus('#playground4', 't0 w4 l4 d0 w8 a1 w8 l1 w8 l1 w8 a4 d0 h0');
    inflateBus('#playground5', 't0 d5 w2 a3 w2 l2 d5 t1 w2 a0 w2 l0 d5 w2 l3 w2 a3 d5 h0');
    inflateBus('#playground6', 't0 w6 d6 w2 a0 w2 l0 d6 w0 l3 w2 a3 w6 d6 h0');
});
</script>
</head>
<body>
    <span id='slots'></span>
</body>
</html>